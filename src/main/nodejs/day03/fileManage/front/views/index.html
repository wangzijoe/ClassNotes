<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
<title>我的雲盤</title>
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
<style type="text/css">
.idCheck {
	top: 50%;
	transform: translateY(15%);
}

.folderName {
	font-weight: bold;
	color: black;
}

.fileName {
	font-weight: bold;
}
</style>
</head>
<body>

	<div class="container">

		<nav class="navbar navbar-default">
			<div class="container-fluid">
				<!-- Brand and toggle get grouped for better mobile display -->
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
						data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">我的雲盤</a>
				</div>

				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="active">
							<a href="#">
								新建文件夹
								<span class="sr-only">(current)</span>
							</a>
						</li>
						<li>
							<a href="#">上傳</a>
						</li>
						<li>
							<a href="#">删除</a>
						</li>
					</ul>
					<!-- /.container-fluid -->
					<form class="navbar-form navbar-left" role="search">
						<div class="form-group">
							<input type="text" class="form-control" placeholder="Search">
						</div>
						<button type="submit" class="btn btn-default">Submit</button>
					</form>
				</div>
				<!-- /.navbar-collapse -->
			</div>
		</nav>
		<!-- 路径导航 -->
		<ol class="breadcrumb" id="breadcrumbArea">
		</ol>
	</div>

	<!-- 文件夹和文件展示区域 -->
	<div class="container">
		<div class="list-group" id="fileAndFolderArea"></div>
	</div>
	<script type="text/x-handlebars-template" id="breadcrumbTemplate">
		{{#each breadcrumb}}
			{{#if isLast}}
				<li class="active">{{name}}</li>
			{{else}}
				<li>
					<a href="#">{{name}}</a>
				</li>
			{{/if}}
		{{/each}}
	</script>
	<script type="text/x-handlebars-template" id="fileAndFolderAreaTemplate">
		{{#each pathInfo}}
			{{#if isFolder}}
				<a href="#" class="list-group-item">
					<input type="checkbox" class="idCheck" />
					<span class="folderName">{{name}}</span>
					<span class="badge">></span>
				</a>
			{{else}}
				<a href="#" class="list-group-item">
					<input type="checkbox" class="idCheck" />
					<span class="fileName">{{name}}</span>
				</a>
			{{/if}}
		{{/each}}
	</script>
	<script type="text/x-handlebars-template" id="fileNameTemplate">

	</script>


	<script src="bootstrap/js/jQuery.js"></script>
	<script src="bootstrap/js/bootstrap.js"></script>
	<script src="https://cdn.bootcss.com/handlebars.js/4.7.3/handlebars.js"></script>

	<script>
		var app = new App();
		var baseUrl = "http://127.0.0.1:88";
		//初始化导航栏
		var breadcrumbPathArr = [ "/" ];
		app.initBreadcrumb(breadcrumbPathArr);
		//构造文件和文件夹区域
		$.get(baseUrl, function(data) {
			app.initFileAndFolderArea(data);
		});


		function App() {
			/**
			 *[ "/" , "home" , "data"]
			 * 接收路径数组，返回面包屑导航HTML，除最后一个以外可点击
			 */
			this.initBreadcrumb = function(breadcrumbPathArr) {
				var data = {};
				var breadcrumb = [];

				for (var i = 0; i < breadcrumbPathArr.length; i++) {
					var breadcrumbJson = {}
					if (i == breadcrumbPathArr.length) {
						breadcrumbJson.isLast = true;
					} else {
						breadcrumbJson.isLast = false;
					}
					breadcrumbJson.name = breadcrumbPathArr[i];
					breadcrumb.push(breadcrumbJson);
					data.breadcrumb = breadcrumb;
				}

				var template = Handlebars.compile($("#breadcrumbTemplate")
						.html());
				var html = template(data);
				$("#breadcrumbArea").html(html);
			}

			/**
			 *var fileAndDirNames = {
			 *	"status" : 200,
			 *	"msg" : {
			 *		"allDirNames" : [ "cookie", "debug", "destroy" ],
			 *		"allFileNames" : [ "wenjianjia.jpg" ]
			 *	}
			 *};
			 * 接收文件和文件夹名称的json数据，返回文件和文件夹区域的html
			 */
			this.initFileAndFolderArea = function(fileAndDirNames) {
				if (fileAndDirNames.status == 200) {
					fileAndDirNames = fileAndDirNames.msg;
					var data = {};
					var pathInfo = [];
					var folderNames = fileAndDirNames.allDirNames;
					for (var i = 0; i < folderNames.length; i++) {
						var pathInfoJson = {};
						pathInfoJson.name = folderNames[i];
						pathInfoJson.isFolder = true;
						pathInfo.push(pathInfoJson);
					}
					var fileNames = fileAndDirNames.allFileNames;
					for (var i = 0; i < fileNames.length; i++) {
						var pathInfoJson = {};
						pathInfoJson.name = fileNames[i];
						pathInfoJson.isFolder = false;
						pathInfo.push(pathInfoJson);
						data.pathInfo = pathInfo;
					}

					var template = Handlebars.compile($(
							"#fileAndFolderAreaTemplate").html());
					var html = template(data);
					$("#fileAndFolderArea").html(html);
					$("a").click(function(e) {
						$("a").removeClass("active");
						$(e.target).addClass("active");
					});
				}
			}
		}
	</script>
</body>
</html>